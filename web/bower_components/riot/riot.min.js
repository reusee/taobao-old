/* Riot v2.1.0, @license MIT, (c) 2015 Muut Inc. + contributors */
(function(e){var t={version:"v2.1.0",settings:{}};t.observable=function(e){e=e||{};var t={},n=0;e.on=function(i,r){if(typeof r=="function"){r._id=typeof r._id=="undefined"?n++:r._id;i.replace(/\S+/g,function(e,n){(t[e]=t[e]||[]).push(r);r.typed=n>0})}return e};e.off=function(n,i){if(n=="*")t={};else{n.replace(/\S+/g,function(e){if(i){var n=t[e];for(var r=0,o;o=n&&n[r];++r){if(o._id==i._id){n.splice(r,1);r--}}}else{t[e]=[]}})}return e};e.one=function(t,n){function i(){e.off(t,i);n.apply(e,arguments)}return e.on(t,i)};e.trigger=function(n){var i=[].slice.call(arguments,1),r=t[n]||[];for(var o=0,u;u=r[o];++o){if(!u.busy){u.busy=1;u.apply(e,u.typed?[n].concat(i):i);if(r[o]!==u){o--}u.busy=0}}if(t.all&&n!="all"){e.trigger.apply(e,["all",n].concat(i))}return e};return e};t.mixin=function(){var e={};return function(t,n){if(!n)return e[t];else e[t]=n}}();(function(e,t,n){if(!n)return;var i=n.location,r=e.observable(),o=n,u=false,f;function a(){return i.href.split("#")[1]||""}function s(e){return e.split("/")}function l(e){if(e.type)e=a();if(e!=f){r.trigger.apply(null,["H"].concat(s(e)));f=e}}var c=e.route=function(e){if(e[0]){i.hash=e;l(e)}else{r.on("H",e)}};c.exec=function(e){e.apply(null,s(a()))};c.parser=function(e){s=e};c.stop=function(){if(!u)return;o.removeEventListener?o.removeEventListener(t,l,false):o.detachEvent("on"+t,l);r.off("*");u=false};c.start=function(){if(u)return;o.addEventListener?o.addEventListener(t,l,false):o.attachEvent("on"+t,l);u=true};c.start()})(t,"hashchange",e);var n=function(e,n,i){return function(r){n=t.settings.brackets||e;if(i!=n)i=n.split(" ");return r&&r.test?n==e?r:RegExp(r.source.replace(/\{/g,i[0].replace(/(?=.)/g,"\\")).replace(/\}/g,i[1].replace(/(?=.)/g,"\\")),r.global?"g":""):i[r]}}("{ }");var i=function(){var t={},i=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(e,n){return e&&(t[e]=t[e]||r(e))(n)};function r(e,t){e=(e||n(0)+n(1)).replace(n(/\\{/g),"￰").replace(n(/\\}/g),"￱");t=f(e,a(e,n(/{/),n(/}/)));return new Function("d","return "+(!t[0]&&!t[2]&&!t[3]?o(t[1]):"["+t.map(function(e,t){return t%2?o(e,true):'"'+e.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")').replace(/\uFFF0/g,n(0)).replace(/\uFFF1/g,n(1))+";")}function o(e,t){e=e.replace(/\n/g," ").replace(n(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),"");return/^\s*[\w- "']+ *:/.test(e)?"["+a(e,/["' ]*[\w- ]+["' ]*:/,/,(?=["' ]*[\w- ]+["' ]*:)|}|$/).map(function(e){return e.replace(/^[ "']*(.+?)[ "']*: *(.+?),? *$/,function(e,t,n){return n.replace(/[^&|=!><]+/g,u)+'?"'+t+'":"",'})}).join("")+'].join(" ").trim()':u(e,t)}function u(t,n){t=t.trim();return!t?"":"(function(v){try{v="+(t.replace(i,function(t,n,i){return i?"(d."+i+"===undefined?"+(typeof e=="undefined"?"global.":"window.")+i+":d."+i+")":t})||"x")+"}catch(e){"+"}finally{return "+(n===true?'!v&&v!==0?"":v':"v")+"}}).call(d)"}function f(e,t){var n=[];t.map(function(t,i){i=e.indexOf(t);n.push(e.slice(0,i),t);e=e.slice(i+t.length)});return n.concat(e)}function a(e,t,n){var i,r=0,o=[],u=new RegExp("("+t.source+")|("+n.source+")","g");e.replace(u,function(t,n,u,f){if(!r&&n)i=f;r+=n?1:-1;if(!r&&u!=null)o.push(e.slice(i,f+u.length))});return o}}();function r(e){var t={val:e},i=e.split(/\s+in\s+/);if(i[1]){t.val=n(0)+i[1];i=i[0].slice(n(0).length).trim().split(/,\s*/);t.key=i[0];t.pos=i[1]}return t}function o(e,t,n){var i={};i[e.key]=t;if(e.pos)i[e.pos]=n;return i}function u(e,t,n){g(e,"each");var u=e.outerHTML,f=e.previousSibling,a=e.parentNode,l=[],c=[],p;n=r(n);function v(e,t,n){l.splice(e,0,t);c.splice(e,0,n)}t.one("update",function(){a.removeChild(e)}).one("premount",function(){if(a.stub)a=t.root}).on("update",function(){var e=i(n.val,t);if(!e)return;if(!Array.isArray(e)){var r=JSON.stringify(e);if(r==p)return;p=r;d(c,function(e){e.unmount()});l=[];c=[];e=Object.keys(e).map(function(t){return o(n,t,e[t])})}d(l,function(t){if(t instanceof Object){if(e.indexOf(t)>-1){return}}else{var n=T(e,t),i=T(l,t);if(n.length>=i.length){return}}var r=l.indexOf(t),o=c[r];if(o){o.unmount();l.splice(r,1);c.splice(r,1);return false}});var g=[].indexOf.call(a.childNodes,f)+1;d(e,function(i,r){var f=e.indexOf(i,r),d=l.indexOf(i,r);f<0&&(f=e.lastIndexOf(i,r));d<0&&(d=l.lastIndexOf(i,r));if(!(i instanceof Object)){var h=T(e,i),m=T(l,i);if(h.length>m.length){d=-1}}var b=a.childNodes;if(d<0){if(!p&&n.key)var y=o(n,i,f);var w=new s({tmpl:u},{before:b[g+f],parent:t,root:a,item:y||i});w.mount();v(f,i,w);return true}if(n.pos&&c[d][n.pos]!=f){c[d].one("update",function(e){e[n.pos]=f});c[d].update()}if(f!=d){a.insertBefore(b[g+d],b[g+(f>d?f+1:f)]);return v(f,l.splice(d,1)[0],c.splice(d,1)[0])}});l=e.slice()}).one("updated",function(){C(a,function(e){d(e.attributes,function(n){if(/^(name|id)$/.test(n.name))t[n.value]=e})})})}function f(e,t,i){C(e,function(e){if(e.nodeType==1){e.isLoop=0;if(e.parentNode&&e.parentNode.isLoop)e.isLoop=1;if(e.getAttribute("each"))e.isLoop=1;var r=j(e);if(r&&!e.isLoop){var o=new s(r,{root:e,parent:t},e.innerHTML),u=e.getAttribute("name"),f=u&&u.indexOf(n(0))<0?u:r.name,a=t,l;while(!j(a.root)){if(!a.parent)break;a=a.parent}o.parent=a;l=a.tags[f];if(l){if(!Array.isArray(l))a.tags[f]=[l];a.tags[f].push(o)}else{a.tags[f]=o}e.innerHTML="";i.push(o)}if(!e.isLoop)d(e.attributes,function(n){if(/^(name|id)$/.test(n.name))t[n.value]=e})}})}function a(e,t,i){function r(e,t,r){if(t.indexOf(n(0))>=0){var o={dom:e,expr:t};i.push(h(o,r))}}C(e,function(e){var n=e.nodeType;if(n==3&&e.parentNode.tagName!="STYLE")r(e,e.nodeValue);if(n!=1)return;var i=e.getAttribute("each");if(i){u(e,t,i);return false}d(e.attributes,function(t){var n=t.name,i=n.split("__")[1];r(e,t.value,{attr:i||n,bool:i});if(i){g(e,n);return false}});if(j(e))return false})}function s(e,n,r){var o=t.observable(this),u=N(n.opts)||{},s=w(e.tmpl),l=n.parent,c=[],g=[],m=n.root,b=n.item,y=e.fn,C=m.tagName.toLowerCase(),x={},A,O=/([\w\-]+)\s?=\s?['"]([^'"]+)["']/gim;if(y&&m._tag){m._tag.unmount(true)}if(e.attrs){var T=e.attrs.match(O);d(T,function(e){var t=e.split(/\s?=\s?/);m.setAttribute(t[0],t[1].replace(/['"]/g,""))})}m._tag=this;this._id=v(~~((new Date).getTime()*Math.random()));h(this,{parent:l,root:m,opts:u,tags:{}},b);d(m.attributes,function(e){x[e.name]=e.value});if(s.innerHTML&&!/select/.test(C)&&!/tbody/.test(C)&&!/tr/.test(C))s.innerHTML=L(s.innerHTML,r);function E(){d(Object.keys(x),function(e){u[e]=i(x[e],l||o)})}this.update=function(e,t){h(o,e,b);E();o.trigger("update",b);p(c,o,b);o.trigger("updated")};this.mixin=function(){d(arguments,function(e){e="string"==typeof e?t.mixin(e):e;d(Object.keys(e),function(t){if("init"!=t)o[t]="function"==typeof e[t]?e[t].bind(o):e[t]});if(e.init)e.init.bind(o)()})};this.mount=function(){E();y&&y.call(o,u);M(true);a(s,o,c);if(!o.parent)o.update();o.trigger("premount");if(y){while(s.firstChild)m.appendChild(s.firstChild)}else{A=s.firstChild;m.insertBefore(A,n.before||null)}if(m.stub)o.root=m=l.root;if(!o.parent)o.trigger("mount");else o.parent.one("mount",function(){o.trigger("mount")})};this.unmount=function(e){var t=y?m:A,n=t.parentNode;if(n){if(l){if(Array.isArray(l.tags[C])){d(l.tags[C],function(e,t){if(e._id==o._id)l.tags[C].splice(t,1)})}else l.tags[C]=undefined}else{while(t.firstChild)t.removeChild(t.firstChild)}if(!e)n.removeChild(t)}o.trigger("unmount");M();o.off("*");m._tag=null};function M(e){d(g,function(t){t[e?"mount":"unmount"]()});if(l){var t=e?"on":"off";l[t]("update",o.update)[t]("unmount",o.unmount)}}f(s,this,g)}function l(t,n,i,r,o){i[t]=function(t){t=t||e.event;t.which=t.which||t.charCode||t.keyCode;t.target=t.target||t.srcElement;t.currentTarget=i;t.item=o;if(n.call(r,t)!==true&&!/radio|check/.test(i.type)){t.preventDefault&&t.preventDefault();t.returnValue=false}if(!t.preventUpdate){var u=o?r.parent:r;u.update()}}}function c(e,t,n){if(e){e.insertBefore(n,t);e.removeChild(t)}}function p(e,t,n){d(e,function(e,r){var o=e.dom,u=e.attr,f=i(e.expr,t),a=e.dom.parentNode;if(f==null)f="";if(a&&a.tagName=="TEXTAREA")f=f.replace(/riot-/g,"");if(e.value===f)return;e.value=f;if(!u)return o.nodeValue=f.toString();g(o,u);if(typeof f=="function"){l(u,f,o,t,n)}else if(u=="if"){var s=e.stub;if(f){s&&c(s.parentNode,s,o)}else{s=e.stub=s||document.createTextNode("");c(o.parentNode,o,s)}}else if(/^(show|hide)$/.test(u)){if(u=="hide")f=!f;o.style.display=f?"":"none"}else if(u=="value"){o.value=f}else if(u.slice(0,5)=="riot-"){u=u.slice(5);f?o.setAttribute(u,f):g(o,u)}else{if(e.bool){o[u]=f;if(!f)return;f=u}if(typeof f!="object")o.setAttribute(u,f)}})}function d(e,t){for(var n=0,i=(e||[]).length,r;n<i;n++){r=e[n];if(r!=null&&t(r,n)===false)n--}return e}function g(e,t){e.removeAttribute(t)}function v(e){return(e^e>>31)-(e>>31)}function h(e,t,n){t&&d(Object.keys(t),function(n){e[n]=t[n]});return n?h(e,n):e}function m(){if(e){var t=navigator.userAgent;var n=t.indexOf("MSIE ");if(n>0){return parseInt(t.substring(n+5,t.indexOf(".",n)),10)}else{return 0}}}function b(e,t){var n=document.createElement("option"),i=/value=[\"'](.+?)[\"']/,r=/selected=[\"'](.+?)[\"']/,o=t.match(i),u=t.match(r);n.innerHTML=t;if(o){n.value=o[1]}if(u){n.setAttribute("riot-selected",u[1])}e.appendChild(n)}function y(e,t,n){var i=document.createElement("div");i.innerHTML="<table>"+t+"</table>";if(/td|th/.test(n)){e.appendChild(i.firstChild.firstChild.firstChild.firstChild)}else{e.appendChild(i.firstChild.firstChild.firstChild)}}function w(e){var t=e.trim().slice(1,3).toLowerCase(),n=/td|th/.test(t)?"tr":t=="tr"?"tbody":"div",i=x(n);i.stub=true;if(t==="op"&&E&&E<10){b(i,e)}else if((n==="tbody"||n==="tr")&&E&&E<10){y(i,e,t)}else i.innerHTML=e;return i}function C(e,t){if(e){if(t(e)===false)C(e.nextSibling,t);else{e=e.firstChild;while(e){C(e,t);e=e.nextSibling}}}}function x(e){return document.createElement(e)}function L(e,t){return e.replace(/<(yield)\/?>(<\/\1>)?/gim,t||"")}function A(e,t){t=t||document;return t.querySelectorAll(e)}function O(e,t){return e.filter(function(e){return t.indexOf(e)<0})}function T(e,t){return e.filter(function(e){return e===t})}function N(e){function t(){}t.prototype=e;return new t}var E=m();function m(){if(e){var t=navigator.userAgent;var n=t.indexOf("MSIE ");if(n>0){return parseInt(t.substring(n+5,t.indexOf(".",n)),10)}else{return 0}}}function y(e,t,n){var i=x("div"),r=/td|th/.test(n)?3:2,o;i.innerHTML="<table>"+t+"</table>";o=i.firstChild;while(r--){o=o.firstChild}e.appendChild(o)}function b(e,t){var n=x("option"),i=/value=[\"'](.+?)[\"']/,r=/selected=[\"'](.+?)[\"']/,o=t.match(i),u=t.match(r);n.innerHTML=t;if(o){n.value=o[1]}if(u){n.setAttribute("riot-selected",u[1])}e.appendChild(n)}var M=[],_={},H;function j(e){return _[e.getAttribute("riot-tag")||e.tagName.toLowerCase()]}function S(e){H=H||x("style");if(!document.head)return;if(H.styleSheet)H.styleSheet.cssText+=e;else H.innerHTML+=e;if(!H._rendered)if(H.styleSheet)document.body.appendChild(H);else document.head.appendChild(H);H._rendered=true}function k(e,t,n){var i=_[t],r=e.innerHTML;e.innerHTML="";if(i&&e)i=new s(i,{root:e,opts:n},r);if(i&&i.mount){i.mount();M.push(i);return i.on("unmount",function(){M.splice(M.indexOf(i),1)})}}t.tag=function(e,t,n,i,r){if(typeof i=="function"){r=i;if(/^[\w\-]+\s?=/.test(n)){i=n;n=""}else i=""}if(typeof n=="function")r=n;else if(n)S(n);_[e]={name:e,tmpl:t,attrs:i,fn:r};return e};t.mount=function(e,t,n){var i,r=function(){var e=Object.keys(_);var t=e.join(", ");d(e,function(e){t+=', *[riot-tag="'+e.trim()+'"]'});return t},o,u=[];if(typeof t=="object"){n=t;t=0}if(typeof e=="string"){if(e=="*"){e=o=r()}else{e.split(",").map(function(t){e+=', *[riot-tag="'+t.trim()+'"]'})}i=A(e)}else i=e;if(t=="*"){t=o||r();if(i.tagName){i=A(t,i)}else{var f=[];d(i,function(e){f=A(t,e)});i=f}t=0}function a(e){if(t&&!e.getAttribute("riot-tag"))e.setAttribute("riot-tag",t);var i=t||e.getAttribute("riot-tag")||e.tagName.toLowerCase(),r=k(e,i,n);if(r)u.push(r)}if(i.tagName)a(e);else d(i,a);return u};t.update=function(){return d(M,function(e){e.update()})};t.mountTo=t.mount;t.util={brackets:n,tmpl:i};if(typeof exports==="object")module.exports=t;else if(typeof define==="function"&&define.amd)define(function(){return t});else e.riot=t})(typeof window!="undefined"?window:undefined);
